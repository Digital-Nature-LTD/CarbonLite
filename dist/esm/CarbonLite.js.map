{"version":3,"file":"CarbonLite.js","sources":["../../src/CarbonLite.ts"],"sourcesContent":["import { CarbonLiteMessage } from './elements/CarbonLiteMessage'\r\nimport { CarbonLiteElement } from './elements/CarbonLiteElement'\r\nimport { CarbonLiteConfig } from './types/CarbonLiteConfig';\r\n\r\nexport default class CarbonLite {\r\n    initialised: boolean = false;\r\n\r\n    // objects\r\n    carbonLite: CarbonLiteElement = new CarbonLiteElement();\r\n    carbonLiteMessage: CarbonLiteMessage = new CarbonLiteMessage();\r\n    carbonLiteTimer: ReturnType<typeof setTimeout>|undefined = undefined;\r\n    carbonLiteMessageTimer: ReturnType<typeof setTimeout>|undefined = undefined;\r\n\r\n    // configurable\r\n    config: CarbonLiteConfig = {\r\n        message: 'Saving the planet, one (dark) pixel at a time',\r\n        timeout: 60000,\r\n        backgroundColour: '#000',\r\n        messageTimeout: 3000,\r\n        messageColour: '#222',\r\n        messageColourHover: '#DDD',\r\n        messageBorderColour: '#DDD',\r\n        messageDropShadowColour: '#555',\r\n    };\r\n\r\n    configure(configuration: object){\r\n        this.config = {...this.config, ...configuration}\r\n    }\r\n\r\n    init(configuration: CarbonLiteConfig|null = null) {\r\n        console.log('CarbonLite: initialising')\r\n        if (this.initialised) {\r\n            return\r\n        }\r\n\r\n        if (configuration) {\r\n            this.configure(configuration)\r\n        }\r\n\r\n        if (this.config.message) {\r\n            this.carbonLite.configure(this.config.message);\r\n        }\r\n\r\n        // add styles\r\n        const style = document.createElement('style')\r\n        style.innerHTML = this.generateStyles()\r\n        document.head.appendChild(style)\r\n\r\n        this.addEventListeners()\r\n        this.restartTimer()\r\n        this.initialised = true\r\n    }\r\n\r\n    generateStyles() {\r\n        return `\r\n        carbon-lite {\r\n            position: fixed;\r\n            bottom: 0;\r\n            right: 0;\r\n            top: 0;\r\n            left: 0;\r\n            color: ${this.config.messageColour};\r\n            z-index: 999998;\r\n            background: ${this.config.backgroundColour};\r\n            display: flex;\r\n            justify-content: center;\r\n            align-items: center;\r\n        }\r\n        \r\n        carbon-lite-message {\r\n            position: fixed;\r\n            bottom: 100px;\r\n            right: 100px;\r\n            color: ${this.config.messageColour};\r\n            text-align: center;\r\n            z-index: 999999;\r\n            opacity: 0.8;\r\n            transition: opacity ${this.config.messageTimeout}ms ease-in;\r\n            \r\n            a {\r\n                color: ${this.config.messageColour};\r\n                background: ${this.config.backgroundColour};\r\n                padding: 20px;\r\n                display: block;\r\n                text-decoration: none;\r\n                border-radius: 20px;\r\n                border: 3px solid ${this.config.backgroundColour};\r\n                \r\n                &:hover {\r\n                    color: ${this.config.messageColourHover};\r\n                    text-decoration: underline;\r\n                    border-color: ${this.config.messageBorderColour};\r\n                    filter: drop-shadow(0 0 0.75rem ${this.config.messageDropShadowColour});\r\n                }\r\n                \r\n                svg {\r\n                    height: 100px;\r\n                    display: block;\r\n                    margin: 0 auto 20px auto;\r\n                }               \r\n            }\r\n            \r\n            &.fading {\r\n                opacity: 0;\r\n                \r\n                a {\r\n                    border-color: ${this.config.messageBorderColour};\r\n                    filter: drop-shadow(0 0 0.75rem ${this.config.messageDropShadowColour});\r\n                }\r\n            }\r\n            \r\n            &:hover {\r\n                transition: opacity 0ms linear;\r\n            }\r\n        }\r\n    `;\r\n    }\r\n\r\n    addEventListeners() {\r\n        console.log('CarbonLite: adding event listeners')\r\n\r\n        console.log('CarbonLite: adding mousemove event listeners')\r\n        let CarbonLite = this;\r\n        document.addEventListener(`mousemove`, () => {\r\n            CarbonLite.userInteracted()\r\n        })\r\n\r\n        console.log('CarbonLite: adding message event listeners')\r\n\r\n        CarbonLite.carbonLiteMessage.addEventListener(`mouseenter`, (event) => {\r\n            CarbonLite.carbonLiteMessage.classList.remove('fading')\r\n            if (CarbonLite.carbonLiteMessageTimer) {\r\n                console.log('CarbonLite: clearing message fade out timer due to mouseenter')\r\n                clearTimeout(CarbonLite.carbonLiteMessageTimer)\r\n            }\r\n        })\r\n\r\n        CarbonLite.carbonLiteMessage.addEventListener(`mouseleave`, (event) => {\r\n            CarbonLite.fadeOutMessage()\r\n        })\r\n    }\r\n\r\n    restartTimer() {\r\n        clearTimeout(this.carbonLiteTimer)\r\n        this.carbonLiteTimer = setTimeout(() => { this.open() }, this.config.timeout)\r\n    }\r\n\r\n    userInteracted() {\r\n        if (this.carbonLite) {\r\n            this.hideBackground()\r\n        } else {\r\n            this.restartTimer()\r\n        }\r\n    }\r\n\r\n    hideBackground() {\r\n        if (!this.carbonLite || !this.carbonLite.parentNode) {\r\n            return;\r\n        }\r\n\r\n        document.body.removeChild(this.carbonLite)\r\n        this.fadeOutMessage()\r\n    }\r\n\r\n    hideMessage() {\r\n        let CarbonLite = this;\r\n\r\n        if (!CarbonLite.carbonLiteMessage || !CarbonLite.carbonLiteMessage.parentNode) {\r\n            return;\r\n        }\r\n        console.log('CarbonLite: hiding message')\r\n\r\n        document.body.removeChild(CarbonLite.carbonLiteMessage)\r\n        console.log('CarbonLite: clearing message fade out timer due to message being hidden')\r\n        clearTimeout(CarbonLite.carbonLiteMessageTimer)\r\n        CarbonLite.carbonLiteMessage.classList.remove('fading')\r\n\r\n        console.log('CarbonLite: restarting timer after message has been hidden')\r\n        CarbonLite.restartTimer()\r\n    }\r\n\r\n    fadeOutMessage() {\r\n        console.log('CarbonLite: setting timer to fade out message')\r\n\r\n        this.carbonLiteMessage.classList.add('fading')\r\n        this.carbonLiteMessageTimer = setTimeout(() => { this.hideMessage() }, this.config.messageTimeout)\r\n    }\r\n\r\n    open() {\r\n        console.log('CarbonLite: opening')\r\n        let CarbonLite = this;\r\n\r\n        if (CarbonLite.carbonLiteMessageTimer) {\r\n            console.log('CarbonLite: clearing message fade out timer')\r\n            clearTimeout(CarbonLite.carbonLiteMessageTimer)\r\n        }\r\n\r\n        document.body.appendChild(CarbonLite.carbonLite)\r\n        document.body.appendChild(CarbonLite.carbonLiteMessage)\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}